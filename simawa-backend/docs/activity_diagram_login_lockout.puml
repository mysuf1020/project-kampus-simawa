@startuml
start
:User submit login;
if (Akun diblokir\n(>5 gagal, <15 menit)?) then (ya)
  :Tolak login;\n"account locked";
  stop
else (tidak)
  :Cari user by login;
  if (User ditemukan?) then (ya)
    :Verifikasi password;
    if (Password benar?) then (ya)
      :reset counter gagal;
      :hapus semua refresh_token user;
      :buat access+refresh token;
      stop
    else (tidak)
      :increment counter gagal;
      if (counter >=5?) then (ya)
        :set blockUntil = now+15m;
      endif
      :Tolak login "invalid credentials";
      stop
    endif
  else (tidak)
    :increment counter gagal;
    :Tolak login;
    stop
  endif
endif
@enduml
