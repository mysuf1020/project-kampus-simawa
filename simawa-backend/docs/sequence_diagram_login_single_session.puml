@startuml
actor User
participant "API" as API
database "DB" as DB

User -> API : POST /auth/login (login, password)
API -> DB : FindByLogin(login)
API <-- DB : user
API -> DB : CheckPassword(user.id, password)
API <-- DB : ok
API -> DB : DeleteByUser(user.id)\n(delete old refresh tokens)
API -> DB : Create refresh_token(user.id)
API <-- DB : refresh_token
API --> User : access_token + refresh_token

User2 -> API : POST /auth/login (device lain)
... sama ...
API -> DB : DeleteByUser(user.id)\n(delete device pertama)
API -> DB : Create refresh_token(user.id)
User2 <-- API : tokens baru

== refresh dari device pertama ==
User -> API : POST /auth/refresh (refresh_token lama)
API -> DB : Get(refresh_token lama)
API <-- DB : not found
API --> User : error invalid refresh token
@enduml
